# AmoLeads — Сделки

[Официальная документация AmoCRM, описание полей](https://www.amocrm.ru/developers/content/api/leads)

## Пример использования

Если `flatten = F` (дефолтное значение), то отдает лист с tidy-датафреймами, которые можно джойнить по `id`. 

Обращаться / джойнить можно следующим образом:

```r
library(amocrm)
# получение сделок
leads <- AmoLeads(auth_list = auth_list)

# датафрейм со сделками
leads_df <- leads$leads

# датафрейм со связанными дополнительными полями
leads_custom_fields <- leads$linked_custom_fields

# джойн двух датафреймов выше, на выходе строка будет соответствовать каждому значению доп. поля 
leads_with_custom_fields <- dplyr::left_join(leads_df, leads_custom_fields, by = "id")
```
## Параметры ответа

Лист | Описание
 --- | ---
leads | Сделки
linked_custom_fields | Связанные дополнительные поля
linked_tags | Связанные теги
linked_contacts | Связанные контакты

```r
> leads$linked_contacts

          id contact_id contact_idx
1    8407019   17598777           1
2    8371185   14208139           1
3    8506221   17785331           1
4    8974839   18330015           1
5    8724049   18036015           1
6    8724049   18274957           2
7    9506139   19012589           1
8    9483515   18988821           1
9   10348887   21138261           1
10  10153417   20890191           1
11  10153417   21068645           2
```

## Параметры запроса

Параметр | Описание
 --- | ---
email | **Обязательный**. Ваш e-mail. **Можно не указывать, если указан** `auth_list`.
apikey | **Обязательный**. Ваш API-ключ. **Можно не указывать, если указан** `auth_list`.
domain | **Обязательный**. Ваш поддомен. **Можно не указывать, если указан** `auth_list`.
auth_list | **Обязательный**. Лист с авторизационными данными, подробнее `?AmoAuthList`. **Можно не указывать, если указаны три параметра выше**.
limit | Батчинг запросов. По дефолту 500. Иногда AmoCRM API лагает и не отдает данные, в таких случаях можно попробовать уменьшить этот параметр.
flatten | Если `TRUE`, то делает `left_join` по всем датафреймам. Рекомендуется к использованию только при полном понимании того, что на выходе будет не tidy-датафрейм. Но все же стоит выгружать все листы и джойнить самим в R / BI-системе / БД / etc.
id | Фильтр. Выбрать элемент с заданным ID (если указан этот параметр, все остальные игнорируются). Можно передавать в виде вектора из ID.
query | Фильтр. Поисковый запрос (Осуществляет поиск по заполненым полям сущности).
responsible_user_id | Фильтр. Дополнительный фильтр поиска, по ответственному пользователю (можно передавать в виде вектора). ID можно получить в AmoUsers().
with_with | По дефолту `'is_price_modified_by_robot,loss_reason_name'`. [Подробнее тут](https://www.amocrm.ru/developers/content/api/leads#values).
status | Фильтр по ID статуса сделки (Можно передавать в виде вектора). ID можно получить функцией `AmoPipelinesStatuses()`. 
date_create_from | Фильтр. Выбрать сделки по дате создания "c". Принимает форматы `'2019-01-01'` или `'2019-01-01 12:00:00'`.
date_create_to | Фильтр. Выбрать сделки по дате создания "до". Принимает форматы `'2019-01-01'` или `'2019-01-01 12:00:00'`.
date_modify_from | Фильтр. Выбрать сделки по дате изменения "c". Принимает форматы `'2019-01-01'` или `'2019-01-01 12:00:00'`.
date_modify_to | Фильтр. Выбрать сделки по дате изменения "до". Принимает форматы `'2019-01-01'` или `'2019-01-01 12:00:00'`.
tasks | Фильтр. Сделки без задач – `1`, с невыполенными задачами – `2`.
active | Фильтр. Выбрать все активные сделки – `1`.
